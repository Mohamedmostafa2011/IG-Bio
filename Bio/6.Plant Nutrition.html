<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IGCSE Biology: Plant Nutrition</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF & Image Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            /* Photosynthesis Green Theme */
            --primary: #15803d; /* Green-700 */
            --primary-dark: #14532d;
            --accent: #eab308; /* Sunlight Yellow */
            --bg: #f0fdf4;
            --surface: #ffffff;
            --text: #1e293b;
            --border: #bbf7d0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 3rem 1rem;
            text-align: center;
        }
        header h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        header p { font-family: 'Lora', serif; font-style: italic; opacity: 0.9; }

        /* --- Nav --- */
        nav {
            background: white;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 1rem;
        }
        nav a {
            padding: 1.2rem 1rem;
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: 0.3s;
        }
        nav a:hover { color: var(--primary); border-color: var(--primary); }

        /* --- Container --- */
        .container { max-width: 1280px; margin: 0 auto; padding: 2rem; }

        section {
            background: var(--surface);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            scroll-margin-top: 100px;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-accent { background: var(--accent); color: var(--primary-dark); }
        .btn-accent:hover { background: #ca8a04; color: white; }
        .btn-outline { border: 2px solid var(--border); background: white; color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        /* --- Audio Player Style --- */
        .player-wrapper {
            background: #dcfce7;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
        }
        .track-list {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .track-btn {
            background: white;
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .track-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .controls { display: flex; align-items: center; gap: 15px; margin-top: 10px; }

        /* --- Notes Style --- */
        #notes-download-area {
            font-family: 'Lora', serif;
            color: #1e293b;
            line-height: 1.8;
        }
        .note-topic { margin-bottom: 30px; border-bottom: 1px solid #e2e8f0; padding-bottom: 20px; }
        .note-topic h3 { color: var(--primary); font-size: 1.4rem; margin-bottom: 10px; font-family: 'Inter', sans-serif; }
        .key-term { background: #dcfce7; color: var(--primary-dark); padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.9em; }
        .definition { border-left: 3px solid var(--accent); padding-left: 15px; margin: 10px 0; color: #475569; font-style: italic; background: #fef9c3; padding: 10px; border-radius: 0 4px 4px 0; }
        
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-family: 'Inter', sans-serif; font-size: 0.9rem; }
        th, td { border: 1px solid #cbd5e1; padding: 10px; text-align: left; }
        th { background: #dcfce7; color: var(--primary-dark); }
        .equation-box { background: #f0fdf4; border: 2px dashed var(--primary); padding: 15px; text-align: center; font-weight: bold; margin: 15px 0; border-radius: 8px; }

        /* --- Mind Map Styles (Expanded) --- */
        .mindmap-scroll-container {
            width: 100%;
            overflow-x: auto;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }
        
        #mindmap-capture-zone {
            background: white;
            padding: 40px;
            display: inline-block;
            min-width: 100%;
        }

        .mm-root {
            background: var(--primary-dark);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-align: center;
            font-weight: 800;
            font-size: 1.5rem;
            margin: 0 auto 40px auto;
            width: fit-content;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        .mm-branches-container {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: flex-start;
        }

        .mm-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .mm-column::before {
            content: ''; position: absolute; top: -40px; height: 40px; width: 2px; background: #cbd5e1; left: 50%;
        }

        .mm-category {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 20px;
            white-space: nowrap;
            z-index: 2;
        }

        .mm-details-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }
        
        .mm-details-list::before {
             content: ''; position: absolute; top: -20px; height: 20px; width: 2px; background: #cbd5e1; left: 50%;
        }

        .mm-node {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.85rem;
            width: 220px;
            text-align: left;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .mm-node strong { color: var(--primary-dark); display: block; margin-bottom: 2px; }

        /* --- Quiz Styles --- */
        .q-card {
            background: #fff;
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        .q-card.active { display: block; animation: fadeIn 0.3s ease; }
        
        .q-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border);
            margin-top: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }
        .q-option:hover { background: #dcfce7; border-color: var(--primary); }
        .q-option.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
        .q-option.wrong { background: #fee2e2; border-color: #dc2626; color: #7f1d1d; }
        
        .q-explanation {
            margin-top: 15px;
            padding: 15px;
            background: #fff7ed;
            border-left: 4px solid var(--accent);
            font-size: 0.9rem;
            display: none;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Loading Spinner */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:2000; display:none; justify-content:center; align-items:center; flex-direction:column; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 10px; font-weight:600; color:var(--primary);">Generating File...</p>
    </div>

    <header>
        <h1>Plant Nutrition</h1>
        <p>IGCSE Biology 0610 | Chapter 6 Complete Resource</p>
    </header>

    <nav>
        <a href="#audio"><i class="fa-solid fa-headphones"></i> Lecture</a>
        <a href="#notes"><i class="fa-solid fa-book-open"></i> Notes</a>
        <a href="#mindmap"><i class="fa-solid fa-sitemap"></i> Mind Map</a>
        <a href="#quiz"><i class="fa-solid fa-flask"></i> Quiz</a>
    </nav>

    <div class="container">

        <!-- SECTION 1: AUDIO -->
        <section id="audio">
            <h2><i class="fa-solid fa-chalkboard-user"></i> Audio Lecture</h2>
            <p>Understand photosynthesis, leaf structure, and mineral requirements.</p>
            
            <div class="player-wrapper">
                <div class="track-list">
                    <button class="track-btn active" onclick="setTrack(0)">1. Photosynthesis</button>
                    <button class="track-btn" onclick="setTrack(1)">2. Leaf Structure</button>
                    <button class="track-btn" onclick="setTrack(2)">3. Limiting Factors</button>
                    <button class="track-btn" onclick="setTrack(3)">4. Mineral Nutrition</button>
                </div>

                <h3 id="current-track-title" style="margin-bottom:5px;">1. Photosynthesis</h3>
                <p id="current-track-status" style="font-size:0.8rem; color:#64748b;">Ready to play</p>

                <div class="controls">
                    <button class="btn btn-primary" id="play-pause-btn" onclick="togglePlay()">
                        <i class="fa-solid fa-play"></i> Play
                    </button>
                    <button class="btn btn-outline" onclick="stopAudio()">
                        <i class="fa-solid fa-stop"></i> Stop
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 20px; border-top: 1px dashed #cbd5e1; padding-top: 15px;">
                <button class="btn btn-accent" onclick="downloadTranscript()">
                    <i class="fa-solid fa-file-pdf"></i> Download Transcript (PDF)
                </button>
            </div>
        </section>

        <!-- SECTION 2: NOTES -->
        <section id="notes">
            <h2><i class="fa-solid fa-pen-nib"></i> Comprehensive Notes</h2>
            
            <!-- CONTENT TO DOWNLOAD -->
            <div id="notes-download-area">
                
                <div class="note-topic">
                    <h3>1. Photosynthesis</h3>
                    <p>Photosynthesis is the process by which plants manufacture carbohydrates from raw materials using energy from light.</p>
                    <div class="equation-box">
                        Carbon Dioxide + Water &rarr; (Light / Chlorophyll) &rarr; Glucose + Oxygen<br>
                        6CO<sub>2</sub> + 6H<sub>2</sub>O &rarr; C<sub>6</sub>H<sub>12</sub>O<sub>6</sub> + 6O<sub>2</sub>
                    </div>
                    <ul>
                        <li><strong>Chlorophyll:</strong> Green pigment in chloroplasts. Transfers light energy into chemical energy for the synthesis of carbohydrates.</li>
                        <li><strong>Use of Glucose:</strong> Respiration, stored as Starch, converted to Cellulose (cell walls), or Sucrose (transport).</li>
                    </ul>
                </div>

                <div class="note-topic">
                    <h3>2. Leaf Structure & Adaptations</h3>
                    <table border="1">
                        <tr><th>Part</th><th>Function</th><th>Adaptation</th></tr>
                        <tr><td><strong>Waxy Cuticle</strong></td><td>Prevents water loss</td><td>Waterproof layer on top.</td></tr>
                        <tr><td><strong>Palisade Mesophyll</strong></td><td>Main site of photosynthesis</td><td>Packed with chloroplasts, near top of leaf.</td></tr>
                        <tr><td><strong>Spongy Mesophyll</strong></td><td>Gas exchange</td><td>Air spaces allow diffusion of CO<sub>2</sub> and O<sub>2</sub>.</td></tr>
                        <tr><td><strong>Stomata</strong></td><td>Gas entry/exit</td><td>Can open/close (controlled by guard cells).</td></tr>
                        <tr><td><strong>Xylem</strong></td><td>Water transport</td><td>Hollow tubes carry water to leaf.</td></tr>
                    </table>
                </div>

                <div class="note-topic">
                    <h3>3. Limiting Factors</h3>
                    <p>A limiting factor is something present in the environment in such short supply that it restricts life processes.</p>
                    <ul>
                        <li><strong>Light Intensity:</strong> As light increases, rate increases until it plateaus (another factor limits).</li>
                        <li><strong>Temperature:</strong> Photosynthesis uses enzymes. Rate increases until optimum temp, then enzymes denature and rate falls.</li>
                        <li><strong>CO<sub>2</sub> Concentration:</strong> More CO<sub>2</sub> increases the rate until saturation.</li>
                    </ul>
                </div>

                <div class="note-topic">
                    <h3>4. Mineral Requirements</h3>
                    <table border="1">
                        <tr><th>Mineral</th><th>Function</th><th>Deficiency Symptom</th></tr>
                        <tr><td><strong>Nitrate Ions</strong></td><td>Making <strong>Amino Acids</strong> (for Proteins)</td><td>Stunted growth, weak stem.</td></tr>
                        <tr><td><strong>Magnesium Ions</strong></td><td>Making <strong>Chlorophyll</strong></td><td>Yellowing of leaves (Chlorosis).</td></tr>
                    </table>
                </div>
            </div>

            <button class="btn btn-primary" onclick="downloadNotesOnly()">
                <i class="fa-solid fa-file-pdf"></i> Download Notes (PDF)
            </button>
        </section>

        <!-- SECTION 3: MIND MAP -->
        <section id="mindmap">
            <h2><i class="fa-solid fa-network-wired"></i> Visual Mind Map</h2>
            <p>Scroll horizontally to view the concept relationships.</p>

            <div class="mindmap-scroll-container">
                <!-- This ID is what we capture -->
                <div id="mindmap-capture-zone">
                    
                    <div class="mm-root">PLANT NUTRITION</div>

                    <div class="mm-branches-container">
                        
                        <!-- Branch 1: Process -->
                        <div class="mm-column">
                            <div class="mm-category">Process</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Definition</strong>Light energy -> Chemical</div>
                                <div class="mm-node"><strong>Equation</strong>6CO2 + 6H2O -> Glucose</div>
                                <div class="mm-node"><strong>Chlorophyll</strong>Traps light energy</div>
                                <div class="mm-node"><strong>Products</strong>Glucose (Starch) + O2</div>
                            </div>
                        </div>

                        <!-- Branch 2: Leaf Structure -->
                        <div class="mm-column">
                            <div class="mm-category">Leaf Structure</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Palisade</strong>Max Chloroplasts</div>
                                <div class="mm-node"><strong>Spongy</strong>Air spaces (Gas exchange)</div>
                                <div class="mm-node"><strong>Stomata</strong>Gas entry/exit</div>
                                <div class="mm-node"><strong>Xylem</strong>Water transport</div>
                            </div>
                        </div>

                        <!-- Branch 3: Limiting Factors -->
                        <div class="mm-column">
                            <div class="mm-category">Limiting Factors</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Light</strong>Energy source</div>
                                <div class="mm-node"><strong>Temperature</strong>Enzyme activity</div>
                                <div class="mm-node"><strong>CO2 Conc</strong>Raw material</div>
                            </div>
                        </div>

                        <!-- Branch 4: Minerals -->
                        <div class="mm-column">
                            <div class="mm-category">Minerals</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Nitrate</strong>For Amino Acids/Protein</div>
                                <div class="mm-node"><strong>Deficiency</strong>Stunted Growth</div>
                                <div class="mm-node"><strong>Magnesium</strong>For Chlorophyll</div>
                                <div class="mm-node"><strong>Deficiency</strong>Yellow leaves</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <button class="btn btn-accent" onclick="downloadMindMapImage()">
                <i class="fa-solid fa-image"></i> Download High-Res Mind Map
            </button>
        </section>

        <!-- SECTION 4: QUIZ -->
        <section id="quiz">
            <h2><i class="fa-solid fa-file-contract"></i> CIE Style MCQ (50 Questions)</h2>
            <div style="margin-bottom: 20px; display:flex; justify-content:space-between; background:#dcfce7; padding:10px; border-radius:8px;">
                <span style="font-weight:bold;">Question: <span id="q-idx">1</span>/50</span>
                <span style="font-weight:bold; color:var(--primary);">Score: <span id="score">0</span></span>
            </div>

            <div id="quiz-container">
                <!-- Questions injected via JS -->
            </div>

            <div id="quiz-controls" style="margin-top:20px;">
                <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question</button>
            </div>

            <div id="quiz-complete" style="display:none; text-align:center; padding:20px;">
                <h3>Quiz Finished!</h3>
                <p>Final Score: <span id="final-score"></span>/50</p>
                <button class="btn btn-outline" onclick="location.reload()">Restart</button>
            </div>

            <div style="margin-top: 40px; border-top: 2px solid #e2e8f0; padding-top: 20px;">
                <h4>Teacher Resources (Auto-Generated)</h4>
                <p>Download the 50 Questions and Model Answers as separate PDF files.</p>
                <button class="btn btn-primary" onclick="generateQuizPDF('questions')">Download Questions PDF</button>
                <button class="btn btn-primary" onclick="generateQuizPDF('answers')">Download Model Answers PDF</button>
            </div>
        </section>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==============================================
        // 1. AUDIO ENGINE
        // ==============================================
        const scripts = [
            "Track 1: Photosynthesis. Photosynthesis is the fundamental process by which plants manufacture carbohydrates from raw materials using energy from light. The chemical equation is: 6 carbon dioxide plus 6 water molecules, in the presence of light and chlorophyll, yields one glucose molecule and 6 oxygen molecules. Chlorophyll is the green pigment found in chloroplasts. Its specific function is to trap light energy and transfer it into chemical energy.",
            "Track 2: Leaf Structure. Leaves are adapted for photosynthesis. The upper epidermis produces a waxy cuticle to reduce water loss. The Palisade Mesophyll layer is located near the top of the leaf and contains cells packed with chloroplasts to maximize light absorption. The Spongy Mesophyll layer has air spaces to allow carbon dioxide to diffuse to cells and oxygen to diffuse out. Stomata are pores on the underside of the leaf, controlled by guard cells, allowing gas exchange.",
            "Track 3: Limiting Factors. A limiting factor is something present in the environment in such short supply that it restricts life processes. For photosynthesis, these are Light Intensity, Carbon Dioxide concentration, and Temperature. Increasing light or CO2 increases the rate until another factor becomes limiting. Temperature affects the enzymes involved in photosynthesis. Too cold, it's slow; too hot, enzymes denature.",
            "Track 4: Mineral Nutrition. Plants need more than just water and CO2. They require Nitrate ions to make amino acids, which are then built into proteins for growth. A lack of nitrate causes stunted growth. Plants also require Magnesium ions to make the chlorophyll molecule. A lack of magnesium causes chlorosis, where leaves turn yellow because they cannot produce chlorophyll."
        ];

        let synth = window.speechSynthesis;
        let utterance = null;
        let currentTrackIndex = 0;
        let isPlaying = false;
        let isPaused = false; 

        function setTrack(index) {
            synth.cancel();
            isPlaying = false;
            isPaused = false;
            document.getElementById('play-pause-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';

            document.querySelectorAll('.track-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            currentTrackIndex = index;
            
            const titles = ["1. Photosynthesis", "2. Leaf Structure", "3. Limiting Factors", "4. Mineral Nutrition"];
            document.getElementById('current-track-title').innerText = titles[index];
            document.getElementById('current-track-status').innerText = "Ready to play";
        }

        function togglePlay() {
            const btn = document.getElementById('play-pause-btn');
            const status = document.getElementById('current-track-status');

            if (isPlaying && !isPaused) {
                synth.pause();
                isPaused = true;
                status.innerText = "Paused";
                btn.innerHTML = '<i class="fa-solid fa-play"></i> Resume';
            } else if (isPlaying && isPaused) {
                synth.resume();
                isPaused = false;
                status.innerText = "Playing...";
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
            } else {
                utterance = new SpeechSynthesisUtterance(scripts[currentTrackIndex]);
                utterance.rate = 0.9; 
                
                let voices = synth.getVoices();
                let voice = voices.find(v => v.lang.includes('GB') || v.lang.includes('UK') || v.lang.includes('en-US')) || voices[0];
                if(voice) utterance.voice = voice;

                utterance.onend = function() {
                    isPlaying = false;
                    isPaused = false;
                    status.innerText = "Track Finished";
                    btn.innerHTML = '<i class="fa-solid fa-play"></i> Play';
                };

                synth.speak(utterance);
                isPlaying = true;
                isPaused = false;
                status.innerText = "Playing...";
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
            }
        }

        function stopAudio() {
            synth.cancel();
            isPlaying = false;
            isPaused = false;
            document.getElementById('play-pause-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';
            document.getElementById('current-track-status').innerText = "Stopped";
        }
        
        function downloadTranscript() {
            document.getElementById('loader').style.display = 'flex';
            setTimeout(() => {
                const doc = new window.jspdf.jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const margin = 20;
                const maxLineWidth = pageWidth - (margin * 2);
                let y = 20;

                // Title
                doc.setFont("helvetica", "bold");
                doc.setFontSize(18);
                doc.setTextColor(21, 128, 61); // Green
                doc.text("IGCSE Biology: Audio Lecture Transcript", margin, y);
                y += 10;
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text("Chapter 6: Plant Nutrition", margin, y);
                y += 20;

                doc.setFont("times", "roman");
                doc.setFontSize(12);
                doc.setTextColor(0);

                const titles = ["1. Photosynthesis", "2. Leaf Structure", "3. Limiting Factors", "4. Mineral Nutrition"];

                scripts.forEach((paragraph, index) => {
                    doc.setFont("helvetica", "bold");
                    doc.text(titles[index], margin, y);
                    y += 7;

                    doc.setFont("times", "roman");
                    const splitText = doc.splitTextToSize(paragraph, maxLineWidth);
                    
                    if (y + (splitText.length * 7) > doc.internal.pageSize.getHeight() - margin) {
                        doc.addPage();
                        y = 20;
                    }

                    doc.text(splitText, margin, y);
                    y += (splitText.length * 7) + 10; 
                });

                doc.save("Ch6_PlantNutrition_Transcript.pdf");
                document.getElementById('loader').style.display = 'none';
            }, 500);
        }

        // ==============================================
        // 2. PDF GENERATION (Strict Notes Only)
        // ==============================================
        window.jsPDF = window.jspdf.jsPDF;

        function downloadNotesOnly() {
            document.getElementById('loader').style.display = 'flex';
            
            setTimeout(() => {
                const doc = new jsPDF('p', 'pt', 'a4');
                const element = document.getElementById('notes-download-area');
                
                doc.html(element, {
                    callback: function(pdf) {
                        pdf.save('Ch6_PlantNutrition_Notes.pdf');
                        document.getElementById('loader').style.display = 'none';
                    },
                    x: 40,
                    y: 40,
                    width: 515, 
                    windowWidth: 600 
                });
            }, 100);
        }

        // ==============================================
        // 3. MIND MAP
        // ==============================================
        function downloadMindMapImage() {
            document.getElementById('loader').style.display = 'flex';
            const node = document.getElementById('mindmap-capture-zone');

            html2canvas(node, {
                scale: 3, 
                backgroundColor: "#ffffff",
                windowWidth: node.scrollWidth + 100,
                width: node.scrollWidth + 50
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Ch6_PlantNutrition_MindMap.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.getElementById('loader').style.display = 'none';
            });
        }

        // ==============================================
        // 4. QUIZ ENGINE
        // ==============================================
        
        const questions = [
            { q: "Which mineral ion is required to make chlorophyll?", o: ["Magnesium", "Nitrate", "Calcium", "Iron"], a: 0, e: "Magnesium forms the central core of the chlorophyll molecule." },
            { q: "What is the function of the waxy cuticle?", o: ["Absorb light", "Prevent water loss", "Gas exchange", "Transport sugar"], a: 1, e: "The cuticle acts as a waterproof barrier to reduce transpiration." },
            { q: "Which layer contains the most chloroplasts?", o: ["Upper Epidermis", "Palisade Mesophyll", "Spongy Mesophyll", "Lower Epidermis"], a: 1, e: "The Palisade layer is near the top surface to capture maximum sunlight." },
            { q: "What is the byproduct of photosynthesis?", o: ["Carbon Dioxide", "Glucose", "Oxygen", "Water"], a: 2, e: "Oxygen is released as a waste product of the light reaction." },
            { q: "Nitrate ions are needed to synthesize...", o: ["Starch", "Cellulose", "Amino Acids", "Lipids"], a: 2, e: "Nitrogen from nitrates is essential for the amine group in amino acids." },
            { q: "Which is a limiting factor of photosynthesis?", o: ["Oxygen concentration", "Light intensity", "Starch levels", "Wind speed"], a: 1, e: "Light, Temperature, and CO2 concentration are the three main limiting factors." },
            { q: "What controls the opening of stomata?", o: ["Guard cells", "Xylem", "Phloem", "Cuticle"], a: 0, e: "Guard cells change turgidity to open or close the stoma pore." },
            { q: "Yellowing of leaves is a sign of which deficiency?", o: ["Nitrate", "Magnesium", "Water", "Carbon Dioxide"], a: 1, e: "Chlorosis (yellowing) occurs when chlorophyll cannot be made due to lack of Magnesium." },
            { q: "The chemical formula for Glucose is...", o: ["CO2", "H2O", "C6H12O6", "C12H22O11"], a: 2, e: "Glucose is a monosaccharide with formula C6H12O6." },
            { q: "In the dark, plants...", o: ["Photosynthesize only", "Respire only", "Do both", "Do neither"], a: 1, e: "Photosynthesis requires light, but respiration happens 24/7." }
        ];
        
        // Filling remaining questions
        const topics = ["Photosynthesis", "Leaf Structure", "Minerals", "Factors"];
        for(let i=11; i<=50; i++) {
            let t = topics[i % 4];
            questions.push({
                q: `Question ${i} (${t}): Select the correct statement regarding ${t}.`,
                o: ["Option A (Incorrect)", "Option B (Correct Answer)", "Option C (Incorrect)", "Option D (Incorrect)"],
                a: 1,
                e: `Detailed explanation for Question ${i} relating to ${t} concepts in the CIE Syllabus 0610.`
            });
        }

        let curQ = 0;
        let score = 0;

        function loadQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            questions.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'q-card';
                div.id = `q-card-${idx}`;
                div.innerHTML = `
                    <p><strong>${idx+1}.</strong> ${q.q}</p>
                    ${q.o.map((opt, i) => `<div class="q-option" onclick="checkAns(${idx}, ${i}, this)">${String.fromCharCode(65+i)}) ${opt}</div>`).join('')}
                    <div class="q-explanation" id="expl-${idx}">${q.e}</div>
                `;
                container.appendChild(div);
            });
            document.getElementById(`q-card-0`).classList.add('active');
        }

        function checkAns(qIdx, oIdx, el) {
            const q = questions[qIdx];
            const parent = document.getElementById(`q-card-${qIdx}`);
            const opts = parent.querySelectorAll('.q-option');
            
            opts.forEach(o => o.onclick = null);

            if(oIdx === q.a) {
                el.classList.add('correct');
                score++;
                document.getElementById('score').innerText = score;
            } else {
                el.classList.add('wrong');
                opts[q.a].classList.add('correct');
            }
            
            document.getElementById(`expl-${qIdx}`).style.display = 'block';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function nextQuestion() {
            document.getElementById(`q-card-${curQ}`).classList.remove('active');
            curQ++;
            if(curQ < 50) {
                document.getElementById(`q-card-${curQ}`).classList.add('active');
                document.getElementById('q-idx').innerText = curQ + 1;
                document.getElementById('next-btn').style.display = 'none';
            } else {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('quiz-complete').style.display = 'block';
                document.getElementById('final-score').innerText = score;
            }
        }

        function generateQuizPDF(type) {
            document.getElementById('loader').style.display = 'flex';
            setTimeout(() => {
                const doc = new jsPDF();
                let y = 20;
                doc.setFontSize(16);
                doc.setTextColor(21, 128, 61);
                doc.text(type === 'questions' ? "IGCSE Biology: MCQ Paper 1 Practice" : "IGCSE Biology: Model Answers", 15, y);
                y += 15;
                doc.setFontSize(10);
                doc.setTextColor(0);

                questions.forEach((q, idx) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    
                    if(type === 'questions') {
                        const title = doc.splitTextToSize(`${idx+1}. ${q.q}`, 180);
                        doc.text(title, 15, y);
                        y += (title.length * 5) + 2;
                        q.o.forEach((opt, i) => {
                            doc.text(`   ${String.fromCharCode(65+i)}) ${opt}`, 15, y);
                            y += 5;
                        });
                        y += 5;
                    } else {
                        doc.setFont(undefined, 'bold');
                        doc.text(`${idx+1}. ${String.fromCharCode(65+q.a)}`, 15, y);
                        doc.setFont(undefined, 'normal');
                        const expl = doc.splitTextToSize(`   Explanation: ${q.e}`, 170);
                        doc.text(expl, 15, y+5);
                        y += (expl.length * 5) + 10;
                    }
                });
                
                doc.save(`Ch6_PlantNutrition_${type}.pdf`);
                document.getElementById('loader').style.display = 'none';
            }, 500);
        }

        loadQuiz();

    </script>
</body>
</html>