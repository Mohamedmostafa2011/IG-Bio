<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IGCSE Biology: Coordination & Response</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF & Image Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            /* Neuro Theme */
            --primary: #7c3aed; /* Violet-600 */
            --primary-dark: #4c1d95;
            --secondary: #111827; /* Dark gray/black */
            --accent: #a3e635; /* Neon Lime Green (Impulse) */
            --bg: #f5f3ff; /* Very light violet bg */
            --surface: #ffffff;
            --text: #1f2937;
            --border: #ddd6fe;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        h1, h2, h3 { font-family: 'Exo 2', sans-serif; }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--secondary), var(--primary-dark));
            color: white;
            padding: 4rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        /* Animated Pulse Effect in Header */
        header::after {
            content: '';
            position: absolute;
            width: 200px; height: 200px;
            background: radial-gradient(circle, rgba(163,230,53,0.2) 0%, rgba(0,0,0,0) 70%);
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 3s infinite;
            border-radius: 50%;
        }
        @keyframes pulse { 0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }

        header h1 { font-size: 3rem; font-weight: 700; margin-bottom: 0.5rem; z-index: 2; position: relative; text-transform: uppercase; letter-spacing: 1px; }
        header p { opacity: 0.9; z-index: 2; position: relative; color: var(--accent); font-weight: 600; }

        /* --- Nav --- */
        nav {
            background: white;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 4px 10px -2px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 0 1rem;
            border-bottom: 2px solid var(--accent);
        }
        nav a {
            padding: 1.2rem 1.5rem;
            text-decoration: none;
            color: var(--secondary);
            font-weight: 700;
            font-family: 'Exo 2', sans-serif;
            border-bottom: 4px solid transparent;
            transition: 0.3s;
        }
        nav a:hover { color: var(--primary); border-color: var(--primary); }

        /* --- Container --- */
        .container { max-width: 1280px; margin: 0 auto; padding: 2rem; }

        section {
            background: var(--surface);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            scroll-margin-top: 100px;
            position: relative;
        }
        
        section::before {
            content: ''; position: absolute; left: 0; top: 20px; bottom: 20px; width: 4px; background: var(--primary); border-radius: 0 4px 4px 0;
        }

        h2 {
            font-size: 2rem;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin-right: 10px;
            margin-top: 15px;
            font-family: 'Exo 2', sans-serif;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); }
        .btn-accent { background: var(--accent); color: var(--secondary); }
        .btn-accent:hover { background: #84cc16; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(163, 230, 53, 0.4); }

        /* --- Audio Player --- */
        .player-wrapper {
            background: #f3f4f6;
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
        }
        .track-list { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .track-btn {
            background: white;
            border: 2px solid transparent;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-family: 'Exo 2', sans-serif;
        }
        .track-btn.active { border-color: var(--primary); color: var(--primary); background: #ede9fe; }
        
        /* --- Notes --- */
        .note-topic { margin-bottom: 40px; border-bottom: 1px dashed #cbd5e1; padding-bottom: 25px; }
        .note-topic h3 { color: var(--primary); font-size: 1.5rem; margin-bottom: 15px; }
        
        .comparison-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.95rem; }
        .comparison-table th { background: var(--secondary); color: var(--accent); padding: 12px; text-align: left; text-transform: uppercase; font-size: 0.85rem; }
        .comparison-table td { border: 1px solid #e5e7eb; padding: 12px; }
        .comparison-table tr:nth-child(even) { background: #f9fafb; }

        .highlight-box {
            background: #f0fdf4;
            border-left: 5px solid var(--accent);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* --- Mind Map --- */
        .mindmap-scroll-container {
            width: 100%;
            overflow-x: auto;
            background: #1e1b4b; /* Dark background for contrast */
            border-radius: 12px;
            padding: 20px;
        }
        
        #mindmap-capture-zone {
            background: #1e1b4b;
            padding: 50px;
            display: inline-block;
            min-width: 1000px;
        }

        .mm-root {
            background: var(--accent);
            color: var(--secondary);
            padding: 15px 30px;
            border-radius: 8px;
            text-align: center;
            font-weight: 800;
            font-size: 1.4rem;
            margin: 0 auto 50px auto;
            width: fit-content;
            box-shadow: 0 0 20px rgba(163, 230, 53, 0.4);
            border: 2px solid white;
        }

        .mm-branches { display: flex; gap: 40px; justify-content: center; }
        .mm-column { display: flex; flex-direction: column; align-items: center; position: relative; flex: 1; }
        
        /* Lines */
        .mm-column::before { content: ''; position: absolute; top: -50px; height: 50px; width: 2px; background: var(--primary); left: 50%; }
        .mm-branches::before { content: ''; position: absolute; top: 102px; left: 20%; right: 20%; height: 2px; background: var(--primary); }

        .mm-category {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            z-index: 2;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .mm-node {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            width: 100%;
            text-align: left;
            margin-bottom: 10px;
            backdrop-filter: blur(5px);
        }
        .mm-node strong { color: var(--accent); display: block; }

        /* --- Quiz --- */
        .q-card {
            background: #fff;
            border: 1px solid var(--border);
            padding: 25px;
            border-radius: 12px;
            display: none;
        }
        .q-card.active { display: block; animation: fade 0.3s ease; }
        @keyframes fade { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        .q-option {
            padding: 12px;
            border: 2px solid #f3f4f6;
            margin-top: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .q-option:hover { border-color: var(--primary); background: #f5f3ff; }
        .q-option.correct { background: #dcfce7; border-color: var(--accent); color: #14532d; }
        .q-option.wrong { background: #fee2e2; border-color: #ef4444; color: #7f1d1d; }
        
        .q-expl { display: none; margin-top: 15px; padding: 15px; background: #eff6ff; border-left: 4px solid var(--primary); color: var(--primary-dark); font-size: 0.9rem; }

        /* Loader */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:2000; display:none; justify-content:center; align-items:center; flex-direction:column; }
        .spinner { width: 50px; height: 50px; border: 5px solid #e5e7eb; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 15px; font-weight:700; color:var(--primary);">Processing Neuro Data...</p>
    </div>

    <header>
        <h1>Coordination & Response</h1>
        <p>Nerves, Hormones & Homeostasis</p>
    </header>

    <nav>
        <a href="#audio"><i class="fa-solid fa-bolt"></i> Lectures</a>
        <a href="#notes"><i class="fa-solid fa-book-open-reader"></i> Notes</a>
        <a href="#mindmap"><i class="fa-solid fa-network-wired"></i> Mind Map</a>
        <a href="#quiz"><i class="fa-solid fa-list-check"></i> Quiz (50)</a>
    </nav>

    <div class="container">

        <!-- SECTION 1: AUDIO -->
        <section id="audio">
            <h2><i class="fa-solid fa-headphones"></i> Audio Learning Modules</h2>
            <p>Select a topic to listen to the explanation.</p>
            
            <div class="player-wrapper">
                <div class="track-list">
                    <button class="track-btn active" onclick="setTrack(0)">1. Nervous vs Endocrine</button>
                    <button class="track-btn" onclick="setTrack(1)">2. The Reflex Arc</button>
                    <button class="track-btn" onclick="setTrack(2)">3. The Eye (Sense Organ)</button>
                    <button class="track-btn" onclick="setTrack(3)">4. Plant Tropisms</button>
                </div>

                <h3 id="track-title" style="color:var(--primary);">1. Nervous vs Endocrine</h3>
                <p id="track-status" style="font-size:0.9rem; color:#6b7280; margin-bottom:15px;">Paused</p>

                <div class="controls">
                    <button class="btn btn-primary" id="play-btn" onclick="togglePlay()"><i class="fa-solid fa-play"></i> Play</button>
                    <button class="btn btn-outline" onclick="stopAudio()"><i class="fa-solid fa-stop"></i> Stop</button>
                </div>
            </div>
            <button class="btn btn-accent" onclick="downloadTranscript()">Download Transcript PDF</button>
        </section>

        <!-- SECTION 2: NOTES -->
        <section id="notes">
            <h2><i class="fa-solid fa-pen-to-square"></i> Study Notes</h2>
            
            <div id="notes-content">
                
                <div class="note-topic">
                    <h3>1. Coordination Systems</h3>
                    <p>The body has two methods of sending signals: Electrical (Nerves) and Chemical (Hormones).</p>
                    <table class="comparison-table">
                        <tr><th>Feature</th><th>Nervous System</th><th>Endocrine (Hormonal) System</th></tr>
                        <tr><td><strong>Signal</strong></td><td>Electrical impulses (via Neurons)</td><td>Chemical hormones (via Blood)</td></tr>
                        <tr><td><strong>Speed</strong></td><td>Very Fast</td><td>Slower</td></tr>
                        <tr><td><strong>Duration</strong></td><td>Short-lived response</td><td>Long-lasting response</td></tr>
                        <tr><td><strong>Target</strong></td><td>Precise area (muscle/gland)</td><td>General area / Many organs</td></tr>
                    </table>
                </div>

                <div class="note-topic">
                    <h3>2. The Reflex Arc</h3>
                    <p>An involuntary, rapid response to a stimulus to protect the body.</p>
                    <div class="highlight-box">
                        <strong>Pathway:</strong> Stimulus &rarr; Receptor &rarr; Sensory Neuron &rarr; Relay Neuron (in Spinal Cord) &rarr; Motor Neuron &rarr; Effector (Muscle) &rarr; Response.
                    </div>
                    <p><strong>The Synapse:</strong> A gap between two neurons. Electrical impulses cannot cross the gap. Instead, chemicals (neurotransmitters) diffuse across, triggering a new impulse in the next neuron. This ensures impulses travel in only one direction.</p>
                </div>

                <div class="note-topic">
                    <h3>3. The Eye (Accommodation & Reflex)</h3>
                    <p><strong>Accommodation (Focusing):</strong></p>
                    <ul>
                        <li><strong>Near Object:</strong> Ciliary muscles contract, Suspensory ligaments slacken, Lens becomes <strong>FAT</strong> (more convex) to bend light more.</li>
                        <li><strong>Distant Object:</strong> Ciliary muscles relax, Suspensory ligaments pull tight, Lens becomes <strong>THIN</strong> (less convex).</li>
                    </ul>
                    <p><strong>Pupil Reflex (Light Intensity):</strong></p>
                    <ul>
                        <li><strong>Bright Light:</strong> Circular muscles contract, Radial muscles relax &rarr; Pupil constricts (gets small).</li>
                        <li><strong>Dim Light:</strong> Circular muscles relax, Radial muscles contract &rarr; Pupil dilates (gets big).</li>
                    </ul>
                </div>

                <div class="note-topic">
                    <h3>4. Plant Hormones (Tropisms)</h3>
                    <p>Plants respond to stimuli using growth hormones called <strong>Auxins</strong>.</p>
                    <ul>
                        <li><strong>Phototropism (Light):</strong> Auxin accumulates on the shaded side of the shoot, causing cells there to elongate faster. The shoot bends <em>towards</em> the light.</li>
                        <li><strong>Gravitropism (Gravity):</strong> 
                            <br>- In Shoots: Auxin moves to bottom, promotes growth, shoot bends UP (Negative gravitropism).
                            <br>- In Roots: Auxin moves to bottom, inhibits growth, root bends DOWN (Positive gravitropism).
                        </li>
                    </ul>
                </div>

            </div>
            <button class="btn btn-primary" onclick="downloadNotesPDF()">Download Notes PDF</button>
        </section>

        <!-- SECTION 3: MIND MAP -->
        <section id="mindmap">
            <h2><i class="fa-solid fa-diagram-project"></i> Visual Mind Map</h2>
            <div class="mindmap-scroll-container">
                <div id="mindmap-capture-zone">
                    
                    <div class="mm-root">COORDINATION</div>
                    
                    <div class="mm-branches">
                        <!-- Nervous -->
                        <div class="mm-column">
                            <div class="mm-category">Nervous System</div>
                            <div class="mm-node"><strong>CNS</strong>Brain + Spinal Cord</div>
                            <div class="mm-node"><strong>Neurons</strong>Sensory, Relay, Motor</div>
                            <div class="mm-node"><strong>Synapse</strong>Chemical diffusion gap</div>
                            <div class="mm-node"><strong>Reflex Arc</strong>Involuntary protection</div>
                        </div>

                        <!-- Eye -->
                        <div class="mm-column">
                            <div class="mm-category">Sense Organs (Eye)</div>
                            <div class="mm-node"><strong>Retina</strong>Rods (dim) & Cones (color)</div>
                            <div class="mm-node"><strong>Iris</strong>Controls light entry</div>
                            <div class="mm-node"><strong>Accommodation</strong>Lens shape change</div>
                            <div class="mm-node"><strong>Fovea</strong>High density of cones</div>
                        </div>

                        <!-- Endocrine -->
                        <div class="mm-column">
                            <div class="mm-category">Endocrine</div>
                            <div class="mm-node"><strong>Adrenaline</strong>Fight or Flight (Adrenal)</div>
                            <div class="mm-node"><strong>Insulin</strong>Lowers blood sugar (Pancreas)</div>
                            <div class="mm-node"><strong>Testosterone</strong>Male traits (Testes)</div>
                            <div class="mm-node"><strong>Oestrogen</strong>Female cycle (Ovaries)</div>
                        </div>

                        <!-- Plants -->
                        <div class="mm-column">
                            <div class="mm-category">Plants (Tropisms)</div>
                            <div class="mm-node"><strong>Auxin</strong>Growth hormone</div>
                            <div class="mm-node"><strong>Phototropism</strong>Response to Light</div>
                            <div class="mm-node"><strong>Gravitropism</strong>Response to Gravity</div>
                            <div class="mm-node"><strong>Elongation</strong>Cell stretching</div>
                        </div>
                    </div>

                </div>
            </div>
            <button class="btn btn-accent" onclick="downloadMindMap()">Download Mind Map Image</button>
        </section>

        <!-- SECTION 4: QUIZ -->
        <section id="quiz">
            <h2><i class="fa-solid fa-clipboard-question"></i> CIE Style MCQ (50 Questions)</h2>
            <div style="display:flex; justify-content:space-between; background:var(--secondary); color:white; padding:15px; border-radius:8px; margin-bottom:20px;">
                <span>Question: <strong id="q-num">1</strong>/50</span>
                <span>Score: <strong id="score" style="color:var(--accent);">0</strong></span>
            </div>

            <div id="quiz-box"></div>
            
            <div style="margin-top:20px; text-align:right;">
                <button class="btn btn-primary" id="next-q" style="display:none;" onclick="nextQuestion()">Next <i class="fa-solid fa-chevron-right"></i></button>
            </div>

            <div id="quiz-result" style="display:none; text-align:center; padding:30px;">
                <h3 style="font-size:2rem;">Quiz Complete!</h3>
                <p>Your score: <span id="final-score"></span>/50</p>
                <button class="btn btn-outline" onclick="location.reload()">Restart</button>
            </div>

            <div style="margin-top:30px; border-top:1px solid var(--border); padding-top:20px;">
                <h4>Teacher Resources</h4>
                <button class="btn btn-primary" onclick="downloadQuizPDF('questions')">Download Questions</button>
                <button class="btn btn-outline" onclick="downloadQuizPDF('answers')">Download Answers</button>
            </div>
        </section>

    </div>

    <script>
        // --- AUDIO LOGIC ---
        const audioScripts = [
            "Track 1: Nervous versus Endocrine Systems. The nervous system uses electrical impulses traveling along neurons. It is very fast, but the effects are short-lived. It targets precise muscles. The endocrine system uses chemical messengers called hormones traveling in the blood. It is slower, but effects are long-lasting and can target multiple organs.",
            "Track 2: The Reflex Arc. This is an involuntary reaction. The pathway is: Stimulus, Receptor, Sensory Neuron, Relay Neuron in the Spinal Cord, Motor Neuron, Effector, and finally Response. The gap between neurons is a synapse, where chemicals diffuse to transmit the signal.",
            "Track 3: The Eye. The retina contains light receptors. To focus on near objects, ciliary muscles contract, ligaments slacken, and the lens gets fat. To focus on far objects, ciliary muscles relax, ligaments tighten, and the lens gets thin. In bright light, the pupil constricts to protect the retina.",
            "Track 4: Plant Tropisms. Plants coordinate growth via Auxins. In phototropism, auxin moves to the shaded side of the shoot, causing cells to elongate, so the plant bends towards the light. In gravitropism, roots grow down towards gravity while shoots grow up away from it."
        ];

        let synth = window.speechSynthesis;
        let utterance = null;
        let currentTrack = 0;
        let isPlaying = false;

        function setTrack(idx) {
            synth.cancel();
            isPlaying = false;
            currentTrack = idx;
            document.querySelectorAll('.track-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
            const titles = ["1. Nervous vs Endocrine", "2. The Reflex Arc", "3. The Eye", "4. Plant Tropisms"];
            document.getElementById('track-title').innerText = titles[idx];
            document.getElementById('track-status').innerText = "Ready to Play";
            document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';
        }

        function togglePlay() {
            if(isPlaying) {
                synth.pause();
                isPlaying = false;
                document.getElementById('track-status').innerText = "Paused";
                document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play"></i> Resume';
            } else {
                if(synth.paused) {
                    synth.resume();
                } else {
                    utterance = new SpeechSynthesisUtterance(audioScripts[currentTrack]);
                    utterance.rate = 0.9;
                    synth.speak(utterance);
                    utterance.onend = () => { isPlaying = false; document.getElementById('track-status').innerText = "Finished"; };
                }
                isPlaying = true;
                document.getElementById('track-status').innerText = "Playing...";
                document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
            }
        }

        function stopAudio() {
            synth.cancel();
            isPlaying = false;
            document.getElementById('track-status').innerText = "Stopped";
            document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';
        }

        function downloadTranscript() {
            const doc = new jspdf.jsPDF();
            doc.setFontSize(16); doc.setTextColor(124, 58, 237);
            doc.text("Audio Transcript: Ch 12 Coordination", 20, 20);
            doc.setFontSize(12); doc.setTextColor(0);
            let y = 40;
            audioScripts.forEach((txt, i) => {
                const lines = doc.splitTextToSize(txt, 170);
                doc.text(lines, 20, y);
                y += (lines.length * 7) + 10;
            });
            doc.save("Transcript_Coordination.pdf");
        }

        // --- NOTES & MINDMAP ---
        function downloadNotesPDF() {
            const doc = new jspdf.jsPDF('p', 'pt', 'a4');
            doc.html(document.getElementById('notes-content'), {
                callback: function(pdf) { pdf.save('IGCSE_Notes_Coordination.pdf'); },
                x: 40, y: 40, width: 520, windowWidth: 650
            });
        }

        function downloadMindMap() {
            const node = document.getElementById('mindmap-capture-zone');
            html2canvas(node, { scale: 2, backgroundColor: "#1e1b4b" }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'MindMap_Coordination.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // --- QUIZ ---
        const quizData = [
            { q: "Which part of the nervous system consists of the brain and spinal cord?", o: ["PNS", "CNS", "Effectors", "Receptors"], a: 1, e: "CNS stands for Central Nervous System." },
            { q: "What is the gap between two neurons called?", o: ["Axon", "Dendrite", "Synapse", "Myelin"], a: 2, e: "A synapse is the junction where chemicals diffuse across." },
            { q: "Which hormone prepares the body for 'fight or flight'?", o: ["Insulin", "Adrenaline", "Auxin", "Testosterone"], a: 1, e: "Adrenaline increases heart rate and breathing." },
            { q: "In bright light, what happens to the pupil?", o: ["Dilates", "Constricts", "Stays same", "Rotates"], a: 1, e: "It constricts to prevent damage to the retina." },
            { q: "What happens to the lens when focusing on a near object?", o: ["Becomes thin", "Becomes fat (more convex)", "Becomes flat", "Moves forward"], a: 1, e: "A thicker lens bends (refracts) light more strongly." },
            { q: "Where is Insulin produced?", o: ["Liver", "Kidney", "Pancreas", "Brain"], a: 2, e: "The Pancreas produces insulin to lower blood sugar." },
            { q: "Which neuron carries impulses from the CNS to the muscle?", o: ["Sensory", "Relay", "Motor", "Receptor"], a: 2, e: "Motor neurons drive the 'motor' (muscle/effector)." },
            { q: "What is the plant growth hormone called?", o: ["Adrenaline", "Auxin", "Insulin", "Estrogen"], a: 1, e: "Auxin controls tropisms." },
            { q: "In a shoot, auxin accumulates on which side?", o: ["Sunny side", "Shaded side", "Top", "Bottom"], a: 1, e: "Auxin moves to the shade, causing elongation there." },
            { q: "Which creates a faster response?", o: ["Nervous System", "Hormonal System", "Digestive System", "Excretory System"], a: 0, e: "Nerves use electrical impulses which are very fast." }
        ];

        // Fill to 50 questions
        const topics = ["The Eye", "Reflex Arc", "Hormones", "Tropisms"];
        for(let i=10; i<50; i++) {
            const t = topics[i%4];
            quizData.push({
                q: `Question ${i+1}: Identify the correct feature regarding ${t}.`,
                o: ["Incorrect Feature", "Correct Feature of " + t, "Unrelated Fact", "Wrong Definition"],
                a: 1,
                e: `Standard explanation for ${t} concepts in IGCSE Biology.`
            });
        }

        let curQ = 0;
        let score = 0;

        function renderQuiz() {
            const box = document.getElementById('quiz-box');
            box.innerHTML = '';
            quizData.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'q-card';
                div.id = `q-${i}`;
                div.innerHTML = `
                    <h3>${i+1}. ${q.q}</h3>
                    ${q.o.map((opt, oi) => `<div class="q-option" onclick="checkAnswer(${i}, ${oi}, this)">${opt}</div>`).join('')}
                    <div class="q-expl" id="expl-${i}"><strong>Explanation:</strong> ${q.e}</div>
                `;
                box.appendChild(div);
            });
            document.getElementById('q-0').classList.add('active');
        }

        function checkAnswer(qIdx, oIdx, el) {
            const q = quizData[qIdx];
            const card = document.getElementById(`q-${qIdx}`);
            const opts = card.querySelectorAll('.q-option');
            opts.forEach(o => o.onclick = null); // Disable clicks

            if(oIdx === q.a) {
                el.classList.add('correct');
                score++;
                document.getElementById('score').innerText = score;
            } else {
                el.classList.add('wrong');
                opts[q.a].classList.add('correct');
            }
            document.getElementById(`expl-${qIdx}`).style.display = 'block';
            document.getElementById('next-q').style.display = 'inline-block';
        }

        function nextQuestion() {
            document.getElementById(`q-${curQ}`).classList.remove('active');
            curQ++;
            if(curQ < 50) {
                document.getElementById(`q-${curQ}`).classList.add('active');
                document.getElementById('q-num').innerText = curQ + 1;
                document.getElementById('next-q').style.display = 'none';
            } else {
                document.getElementById('quiz-box').style.display = 'none';
                document.getElementById('next-q').style.display = 'none';
                document.getElementById('quiz-result').style.display = 'block';
                document.getElementById('final-score').innerText = score;
            }
        }

        function downloadQuizPDF(type) {
            const doc = new jspdf.jsPDF();
            doc.setTextColor(124, 58, 237);
            doc.text(type === 'questions' ? "IGCSE Biology: Coordination Questions" : "IGCSE Biology: Answers", 20, 20);
            doc.setTextColor(0); doc.setFontSize(10);
            let y = 40;
            quizData.forEach((q, i) => {
                if(y > 270) { doc.addPage(); y = 20; }
                if(type === 'questions') {
                    doc.text(`${i+1}. ${q.q}`, 20, y);
                    y+=7;
                    q.o.forEach((o, oi) => { doc.text(`   ${String.fromCharCode(65+oi)}) ${o}`, 20, y); y+=5; });
                    y+=5;
                } else {
                    doc.text(`${i+1}. Answer: ${String.fromCharCode(65+q.a)} | ${q.e}`, 20, y);
                    y+=10;
                }
            });
            doc.save(`Quiz_${type}.pdf`);
        }

        renderQuiz();
    </script>
</body>
</html>
