<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Bio's Lab of Chaos | IGCSE Bio Game</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PDF Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --goo-color: #4ade80;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --neon-purple: #d946ef;
            --neon-blue: #3b82f6;
            --bg-dark: #0f172a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            background-color: var(--bg-dark);
            font-family: 'Roboto Mono', monospace;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- HEADER --- */
        header {
            text-align: center;
            margin: 20px 0;
            animation: flicker 3s infinite;
        }

        h1 {
            font-family: 'Bangers', cursive;
            font-size: 3.5rem;
            color: var(--neon-purple);
            text-shadow: 0 0 10px var(--neon-purple);
            letter-spacing: 2px;
        }

        /* --- THE LAB BENCH --- */
        .lab-bench {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            width: 90%;
            max-width: 1200px;
        }

        /* --- THE SPECIMEN JAR --- */
        .jar-container {
            position: relative;
            width: 300px;
            height: 400px;
        }

        .jar {
            width: 100%;
            height: 100%;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .liquid {
            position: absolute; bottom: 0; width: 100%; height: 20%;
            background: rgba(59, 130, 246, 0.2);
            transition: height 0.5s;
        }

        /* --- THE BLOB (CREATURE) --- */
        #creature {
            font-size: 5rem;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 2;
            position: relative;
        }

        /* Creature States */
        .wiggle { animation: wiggle 0.5s infinite; }
        .pulse { animation: pulse 1s infinite; }
        .explode { animation: explode 0.5s forwards; }
        .spin { animation: spin 1s infinite linear; }
        .float { animation: float 3s ease-in-out infinite; }

        @keyframes wiggle { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        @keyframes explode { 0% { transform: scale(1); } 50% { transform: scale(1.5); color: red; } 100% { transform: scale(0); opacity: 0; } }

        /* --- STATUS LOG (The "Funny" Part) --- */
        .clipboard {
            background: #fff;
            color: #000;
            width: 300px;
            padding: 20px;
            border-radius: 5px;
            transform: rotate(2deg);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
        }

        .clipboard h2 { font-family: 'Bangers'; font-size: 1.5rem; border-bottom: 2px solid red; margin-bottom: 10px; }
        .log-entry { font-size: 0.9rem; margin-bottom: 8px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .log-entry:last-child { font-weight: bold; color: blue; }

        /* --- SERUM RACK (Controls) --- */
        .serum-rack {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            background: #1e293b;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #334155;
            width: 100%;
            max-width: 500px;
        }

        .serum-btn {
            background: #334155;
            border: none;
            border-bottom: 4px solid #0f172a;
            border-radius: 8px;
            padding: 15px 5px;
            color: white;
            font-family: 'Bangers';
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .serum-btn:active { transform: translateY(4px); border-bottom: 0; }
        .serum-btn i { font-size: 1.5rem; margin-bottom: 5px; color: #94a3b8; }
        
        .serum-btn.active { background: var(--neon-purple); border-color: #a21caf; }
        .serum-btn.active i { color: white; }

        /* Tooltips */
        .serum-btn:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: #fff;
            padding: 5px;
            font-size: 0.8rem;
            font-family: 'Roboto Mono';
            border-radius: 5px;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Reset Button */
        .reset-btn {
            grid-column: span 4;
            background: #ef4444;
            border-color: #991b1b;
            margin-top: 10px;
        }

        /* Win Overlay */
        #winScreen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        #winScreen h2 { font-family: 'Bangers'; color: var(--goo-color); font-size: 4rem; }
        .confetti { position: fixed; width: 10px; height: 10px; background: #f0f; animation: fall 2s linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

    </style>
</head>
<body>

    <header>
        <h1><i class="fa-solid fa-flask"></i> Dr. Bio's Lab of Chaos</h1>
        <p>Inject the 7 Serums of Life (MRS GREN) to create a living organism!</p>
    </header>

    <div class="lab-bench">
        
        <!-- LEFT: THE JAR -->
        <div class="jar-container">
            <div class="jar">
                <div class="liquid" id="liquidLevel"></div>
                <div id="creature">ðŸ¦ </div>
            </div>
        </div>

        <!-- MIDDLE: THE CONTROLS -->
        <div class="serum-rack">
            <button class="serum-btn" id="btn-M" onclick="inject('M')" data-tooltip="Action causing change of position">
                <i class="fa-solid fa-person-running"></i> M
            </button>
            <button class="serum-btn" id="btn-R1" onclick="inject('R1')" data-tooltip="Releasing energy from nutrients">
                <i class="fa-solid fa-fire"></i> R
            </button>
            <button class="serum-btn" id="btn-S" onclick="inject('S')" data-tooltip="Detecting stimuli">
                <i class="fa-solid fa-eye"></i> S
            </button>
            <button class="serum-btn" id="btn-G" onclick="inject('G')" data-tooltip="Permanent increase in size">
                <i class="fa-solid fa-arrow-up-right-dots"></i> G
            </button>
            <button class="serum-btn" id="btn-R2" onclick="inject('R2')" data-tooltip="Making more of the same kind">
                <i class="fa-solid fa-baby"></i> R
            </button>
            <button class="serum-btn" id="btn-E" onclick="inject('E')" data-tooltip="Removal of toxic waste">
                <i class="fa-solid fa-poop"></i> E
            </button>
            <button class="serum-btn" id="btn-N" onclick="inject('N')" data-tooltip="Taking in materials for energy">
                <i class="fa-solid fa-utensils"></i> N
            </button>
            <button class="serum-btn reset-btn" onclick="resetLab()">
                <i class="fa-solid fa-triangle-exclamation"></i> FLUSH / RESET
            </button>
        </div>

        <!-- RIGHT: STATUS LOG -->
        <div class="clipboard">
            <h2>Experiment Log</h2>
            <div id="logArea">
                <div class="log-entry">Day 1: Specimen is lifeless goo.</div>
                <div class="log-entry">Awaiting MRS GREN infusion...</div>
            </div>
        </div>

    </div>

    <!-- WIN SCREEN -->
    <div id="winScreen">
        <h2>IT'S ALIVE!</h2>
        <p style="color:white; margin-bottom:20px; font-size:1.2rem;">You successfully combined all 7 characteristics!</p>
        <div style="font-size:5rem; margin-bottom:20px;" class="wiggle">ðŸ‘½</div>
        <button class="serum-btn" style="width:200px; background:var(--neon-purple);" onclick="downloadDiploma()">Claim Diploma</button>
        <br>
        <button class="serum-btn" style="width:200px;" onclick="resetLab()">Play Again</button>
    </div>

    <script>
        // Game State
        let state = {
            M: false, // Movement
            R1: false, // Respiration
            S: false, // Sensitivity
            G: false, // Growth
            R2: false, // Reproduction
            E: false, // Excretion
            N: false  // Nutrition
        };

        const creature = document.getElementById('creature');
        const logArea = document.getElementById('logArea');
        const liquid = document.getElementById('liquidLevel');

        function inject(type) {
            // If already active, do nothing or complain
            if (state[type]) {
                log("Doc, you already gave it that! Don't overdose it!");
                return;
            }

            state[type] = true;
            document.getElementById('btn-' + type).classList.add('active');
            liquid.style.height = (Object.values(state).filter(Boolean).length * 14) + "%";

            // --- CHAOS LOGIC ---
            
            // 1. NUTRITION (N) logic
            if (type === 'N') {
                if (!state.E) {
                    // Ate but can't poop -> Explode risk
                    creature.innerText = 'ðŸ¤¢';
                    log("WARNING: Specimen fed but lacks Excretion! Pressure building!");
                    creature.classList.add('pulse');
                    setTimeout(() => {
                        if(!state.E) {
                            log("SPLAT! Specimen exploded from waste buildup.");
                            creature.classList.add('explode');
                            setTimeout(resetLab, 2000);
                        }
                    }, 5000); // 5 seconds to fix it
                } else {
                    creature.innerText = 'ðŸ˜‹';
                    log("Nutrition accepted. Tasty.");
                }
            }

            // 2. EXCRETION (E) logic
            if (type === 'E') {
                if (creature.classList.contains('pulse')) {
                    creature.classList.remove('pulse');
                    creature.innerText = 'ðŸ˜Œ';
                    log("Crisis averted! Waste removed.");
                } else {
                    log("Excretion system installed. Ready for waste.");
                }
            }

            // 3. MOVEMENT (M) logic
            if (type === 'M') {
                if (!state.R1) {
                    // Try to move but no energy
                    creature.innerText = 'ðŸ˜´';
                    log("It's trying to Move, but lacks Energy (Respiration)!");
                } else {
                    creature.classList.add('wiggle');
                    log("It's moving! Look at it go!");
                }
            }

            // 4. RESPIRATION (R1) logic
            if (type === 'R1') {
                // Energy released
                log("Mitochondria active! Energy released.");
                if (state.M) {
                    creature.classList.add('wiggle');
                    log("Now it has energy to Move!");
                }
            }

            // 5. SENSITIVITY (S) logic
            if (type === 'S') {
                creature.innerText = 'ðŸ‘€';
                log("Specimen can now see you. Stop staring.");
            }

            // 6. GROWTH (G) logic
            if (type === 'G') {
                if (!state.N) {
                    log("It wants to Grow, but has no Food (Nutrition)!");
                } else {
                    creature.style.transform = "scale(1.5)";
                    log("It's getting huge!");
                }
            }

            // 7. REPRODUCTION (R2) logic
            if (type === 'R2') {
                if (Object.values(state).filter(Boolean).length < 6) {
                    log("It's trying to reproduce, but it's not fully alive yet!");
                } else {
                    log("Reproduction enabled. Mitosis imminent.");
                }
            }

            // CHECK WIN CONDITION
            checkWin();
        }

        function log(msg) {
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerText = "> " + msg;
            logArea.appendChild(div);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function checkWin() {
            const allTrue = Object.values(state).every(val => val === true);
            if (allTrue) {
                setTimeout(() => {
                    document.getElementById('winScreen').style.display = 'flex';
                    confettiBlast();
                }, 1000);
            }
        }

        function resetLab() {
            state = { M: false, R1: false, S: false, G: false, R2: false, E: false, N: false };
            document.querySelectorAll('.serum-btn').forEach(btn => btn.classList.remove('active'));
            creature.className = '';
            creature.style.transform = 'scale(1)';
            creature.innerText = 'ðŸ¦ ';
            liquid.style.height = '20%';
            logArea.innerHTML = '<div class="log-entry">Lab reset. New specimen ready.</div>';
            document.getElementById('winScreen').style.display = 'none';
        }

        function confettiBlast() {
            for(let i=0; i<50; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = ['#f00', '#0f0', '#00f', '#ff0'][Math.floor(Math.random()*4)];
                c.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(c);
            }
        }

        // PDF Certificate
        function downloadDiploma() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF("landscape");

            doc.setFillColor(15, 23, 42); 
            doc.rect(0, 0, 297, 210, "F");
            doc.setLineWidth(5);
            doc.setDrawColor(217, 70, 239); 
            doc.rect(10, 10, 277, 190);

            doc.setFont("helvetica", "bold");
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(40);
            doc.text("MASTER OF LIFE", 148, 60, null, null, "center");

            doc.setFontSize(16);
            doc.setFont("courier", "normal");
            doc.text("This certifies mastery of MRS GREN:", 148, 90, null, null, "center");

            const list = [
                "Movement", "Respiration", "Sensitivity",
                "Growth", "Reproduction", "Excretion", "Nutrition"
            ];
            
            let y = 110;
            list.forEach(item => {
                doc.text("- " + item, 120, y);
                y += 10;
            });

            doc.save("Dr_Bio_Diploma.pdf");
        }

    </script>
</body>
</html>
