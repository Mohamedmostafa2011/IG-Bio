<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioBot - CIE 0610 Expert</title>
    <!-- Using Tailwind CSS for fast, beautiful styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Markdown parsing for nice text formatting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col font-sans">

    <!-- Header -->
    <header class="bg-green-600 text-white p-4 shadow-md flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold">ðŸ§¬ BioBot CIE 0610</h1>
            <p class="text-xs text-green-100">IGCSE Biology Specialist</p>
        </div>
        <a href="/" class="text-sm bg-green-700 px-3 py-1 rounded hover:bg-green-800 transition">Back to Home</a>
    </header>

    <!-- Chat Container -->
    <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4">
        <!-- Welcome Message -->
        <div class="flex flex-col space-y-2 max-w-3xl mx-auto">
            <div class="flex items-start">
                <div class="bg-green-100 text-green-900 p-3 rounded-lg rounded-tl-none shadow-sm border border-green-200 max-w-[85%]">
                    <p>Hello! I am trained specifically on the <strong>Cambridge IGCSE Biology (0610)</strong> syllabus.</p>
                    <p class="mt-2">You can ask me to:</p>
                    <ul class="list-disc ml-5 text-sm mt-1">
                        <li>Explain topics (e.g., "Explain Photosynthesis")</li>
                        <li>Quiz you (e.g., "Give me a quiz on the Heart")</li>
                        <li><strong>Generate Diagrams</strong> (Just type: "Image of a plant cell")</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Input Area -->
    <footer class="p-4 bg-white border-t border-gray-200">
        <div class="max-w-3xl mx-auto flex gap-2">
            <input type="text" id="user-input" 
                class="flex-1 border border-gray-300 rounded-full px-4 py-2 focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500"
                placeholder="Ask a biology question or ask for an image..." 
                onkeydown="if(event.key === 'Enter') sendMessage()">
            
            <button onclick="sendMessage()" 
                class="bg-green-600 text-white rounded-full p-2 w-10 h-10 flex items-center justify-center hover:bg-green-700 transition">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
            </button>
        </div>
    </footer>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        // PASTE YOUR GOOGLE GEMINI API KEY BELOW inside the quotes
        const API_KEY = "AIzaSyDkaqPm8vQGn9rU3tv8PBJPKWmJFW5VOtY"; 

        // This instructs the AI how to behave (The "Brain" Tuning)
        const SYSTEM_PROMPT = `
        You are an expert IGCSE Biology Tutor for the CIE 0610 syllabus. 
        Your goal is to help students achieve A* grades.
        1. Only answer questions related to Biology. If asked about other topics, politely decline.
        2. Use terminology from the CIE 0610 syllabus.
        3. Keep answers concise but complete.
        4. If the user asks for an image, diagram, or drawing, simply reply with exactly: "GENERATE_IMAGE: [detailed description of the biology diagram]". Do not add any other text if generating an image.
        `;

        // ==========================================
        // LOGIC
        // ==========================================
        
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // 1. Add User Message to UI
            addMessage(text, 'user');
            userInput.value = '';
            
            // 2. Show Loading Animation
            const loadingId = addLoading();

            try {
                // 3. Call Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [
                            {
                                role: "user",
                                parts: [{ text: SYSTEM_PROMPT + "\n\nUser Question: " + text }]
                            }
                        ]
                    })
                });

                const data = await response.json();
                
                // Remove Loading
                document.getElementById(loadingId).remove();

                if (data.error) {
                    addMessage("Error: " + data.error.message, 'bot');
                    return;
                }

                const botText = data.candidates[0].content.parts[0].text;

                // 4. Check if AI wants to generate an image
                if (botText.includes("GENERATE_IMAGE:")) {
                    const imagePrompt = botText.replace("GENERATE_IMAGE:", "").trim();
                    addImage(imagePrompt);
                } else {
                    addMessage(botText, 'bot');
                }

            } catch (error) {
                document.getElementById(loadingId).remove();
                addMessage("Sorry, I encountered an error. Please check your API Key.", 'bot');
                console.error(error);
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = sender === 'user' ? "flex justify-end" : "flex justify-start";
            
            const bubble = document.createElement('div');
            bubble.className = sender === 'user' 
                ? "bg-green-600 text-white p-3 rounded-lg rounded-tr-none shadow-sm max-w-[85%]" 
                : "bg-white text-gray-800 p-3 rounded-lg rounded-tl-none shadow-sm border border-gray-200 max-w-[85%] prose prose-sm";
            
            // Render Markdown if bot, plain text if user
            if (sender === 'bot') {
                bubble.innerHTML = marked.parse(text);
            } else {
                bubble.textContent = text;
            }

            div.appendChild(bubble);
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function addImage(prompt) {
            const div = document.createElement('div');
            div.className = "flex justify-start";
            
            const container = document.createElement('div');
            container.className = "bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-gray-200 max-w-[85%]";
            
            const caption = document.createElement('p');
            caption.className = "text-xs text-gray-500 mb-2";
            caption.textContent = "Generating diagram for: " + prompt;

            // Using Pollinations.ai for free unlimited image generation
            const img = document.createElement('img');
            // Encode the prompt to make it URL safe
            const safePrompt = encodeURIComponent(prompt + " scientific biological diagram white background high quality");
            img.src = `https://image.pollinations.ai/prompt/${safePrompt}`;
            img.className = "rounded-md w-full h-auto min-h-[200px] bg-gray-100";
            img.alt = prompt;

            container.appendChild(caption);
            container.appendChild(img);
            div.appendChild(container);
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function addLoading() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex justify-start";
            div.innerHTML = `
                <div class="bg-white p-4 rounded-lg rounded-tl-none shadow-sm border border-gray-200 flex space-x-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-green-500 rounded-full typing-dot"></div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return id;
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    </script>
</body>
</html>
