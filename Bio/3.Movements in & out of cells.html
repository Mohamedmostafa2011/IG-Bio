<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IGCSE Biology: Movement In & Out of Cells</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF & Image Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            /* Osmosis Blue Theme */
            --primary: #0284c7; /* Sky-600 */
            --primary-dark: #0c4a6e;
            --accent: #f59e0b; /* Amber for energy/ATP contrast */
            --bg: #f0f9ff;
            --surface: #ffffff;
            --text: #0f172a;
            --border: #bae6fd;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 3rem 1rem;
            text-align: center;
        }
        header h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        header p { font-family: 'Lora', serif; font-style: italic; opacity: 0.9; }

        /* --- Nav --- */
        nav {
            background: white;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 1rem;
        }
        nav a {
            padding: 1.2rem 1rem;
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: 0.3s;
        }
        nav a:hover { color: var(--primary); border-color: var(--primary); }

        /* --- Container --- */
        .container { max-width: 1280px; margin: 0 auto; padding: 2rem; }

        section {
            background: var(--surface);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            scroll-margin-top: 100px;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-accent { background: var(--accent); color: white; }
        .btn-accent:hover { background: #d97706; }
        .btn-outline { border: 2px solid var(--border); background: white; color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        /* --- Audio Player Style --- */
        .player-wrapper {
            background: #e0f2fe;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
        }
        .track-list {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .track-btn {
            background: white;
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .track-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .controls { display: flex; align-items: center; gap: 15px; margin-top: 10px; }

        /* --- Notes Style --- */
        #notes-download-area {
            font-family: 'Lora', serif;
            color: #1e293b;
            line-height: 1.8;
        }
        .note-topic { margin-bottom: 30px; border-bottom: 1px solid #e2e8f0; padding-bottom: 20px; }
        .note-topic h3 { color: var(--primary); font-size: 1.4rem; margin-bottom: 10px; font-family: 'Inter', sans-serif; }
        .key-term { background: #e0f2fe; color: var(--primary-dark); padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.9em; }
        .definition { border-left: 3px solid var(--accent); padding-left: 15px; margin: 10px 0; color: #475569; font-style: italic; background: #fffbeb; padding: 10px; border-radius: 0 4px 4px 0; }
        
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-family: 'Inter', sans-serif; font-size: 0.9rem; }
        th, td { border: 1px solid #cbd5e1; padding: 10px; text-align: left; }
        th { background: #e0f2fe; color: var(--primary-dark); }

        /* --- Mind Map Styles (Expanded) --- */
        .mindmap-scroll-container {
            width: 100%;
            overflow-x: auto;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }
        
        #mindmap-capture-zone {
            background: white;
            padding: 40px;
            display: inline-block;
            min-width: 100%;
        }

        .mm-root {
            background: var(--primary-dark);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-align: center;
            font-weight: 800;
            font-size: 1.5rem;
            margin: 0 auto 40px auto;
            width: fit-content;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        .mm-branches-container {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: flex-start;
        }

        .mm-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .mm-column::before {
            content: ''; position: absolute; top: -40px; height: 40px; width: 2px; background: #cbd5e1; left: 50%;
        }

        .mm-category {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 20px;
            white-space: nowrap;
            z-index: 2;
        }

        .mm-details-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }
        
        .mm-details-list::before {
             content: ''; position: absolute; top: -20px; height: 20px; width: 2px; background: #cbd5e1; left: 50%;
        }

        .mm-node {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.85rem;
            width: 220px;
            text-align: left;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .mm-node strong { color: var(--primary-dark); display: block; margin-bottom: 2px; }

        /* --- Quiz Styles --- */
        .q-card {
            background: #fff;
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        .q-card.active { display: block; animation: fadeIn 0.3s ease; }
        
        .q-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border);
            margin-top: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }
        .q-option:hover { background: #e0f2fe; border-color: var(--primary); }
        .q-option.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
        .q-option.wrong { background: #fee2e2; border-color: #dc2626; color: #7f1d1d; }
        
        .q-explanation {
            margin-top: 15px;
            padding: 15px;
            background: #fff7ed;
            border-left: 4px solid var(--accent);
            font-size: 0.9rem;
            display: none;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Loading Spinner */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:2000; display:none; justify-content:center; align-items:center; flex-direction:column; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 10px; font-weight:600; color:var(--primary);">Generating File...</p>
    </div>

    <header>
        <h1>Movement In & Out of Cells</h1>
        <p>IGCSE Biology 0610 | Chapter 3 Complete Resource</p>
    </header>

    <nav>
        <a href="#audio"><i class="fa-solid fa-headphones"></i> Lecture</a>
        <a href="#notes"><i class="fa-solid fa-book-open"></i> Notes</a>
        <a href="#mindmap"><i class="fa-solid fa-sitemap"></i> Mind Map</a>
        <a href="#quiz"><i class="fa-solid fa-flask"></i> Quiz</a>
    </nav>

    <div class="container">

        <!-- SECTION 1: AUDIO -->
        <section id="audio">
            <h2><i class="fa-solid fa-chalkboard-user"></i> Audio Lecture</h2>
            <p>Select a topic. Pause, resume, and download the transcript for offline study.</p>
            
            <div class="player-wrapper">
                <div class="track-list">
                    <button class="track-btn active" onclick="setTrack(0)">1. Diffusion</button>
                    <button class="track-btn" onclick="setTrack(1)">2. Osmosis</button>
                    <button class="track-btn" onclick="setTrack(2)">3. Effects on Cells</button>
                    <button class="track-btn" onclick="setTrack(3)">4. Active Transport</button>
                </div>

                <h3 id="current-track-title" style="margin-bottom:5px;">1. Diffusion</h3>
                <p id="current-track-status" style="font-size:0.8rem; color:#64748b;">Ready to play</p>

                <div class="controls">
                    <button class="btn btn-primary" id="play-pause-btn" onclick="togglePlay()">
                        <i class="fa-solid fa-play"></i> Play
                    </button>
                    <button class="btn btn-outline" onclick="stopAudio()">
                        <i class="fa-solid fa-stop"></i> Stop
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 20px; border-top: 1px dashed #cbd5e1; padding-top: 15px;">
                <button class="btn btn-accent" onclick="downloadTranscript()">
                    <i class="fa-solid fa-file-pdf"></i> Download Transcript (PDF)
                </button>
            </div>
        </section>

        <!-- SECTION 2: NOTES -->
        <section id="notes">
            <h2><i class="fa-solid fa-pen-nib"></i> Comprehensive Notes</h2>
            
            <!-- CONTENT TO DOWNLOAD -->
            <div id="notes-download-area">
                
                <div class="note-topic">
                    <h3>1. Diffusion</h3>
                    <div class="definition">
                        <strong>Definition:</strong> The net movement of particles from an area of higher concentration to an area of lower concentration, down a concentration gradient, as a result of their random movement.
                    </div>
                    <p>Diffusion is a passive process (requires no energy). Examples: O2 diffusing into red blood cells, CO2 diffusing out of leaves.</p>
                    
                    <h4>Factors Affecting Rate of Diffusion:</h4>
                    <ul>
                        <li><strong>Surface Area:</strong> Larger surface area = Faster rate.</li>
                        <li><strong>Temperature:</strong> Higher temperature = More kinetic energy = Faster rate.</li>
                        <li><strong>Concentration Gradient:</strong> Steeper gradient = Faster rate.</li>
                        <li><strong>Diffusion Distance:</strong> Thicker membrane = Slower rate.</li>
                    </ul>
                </div>

                <div class="note-topic">
                    <h3>2. Osmosis</h3>
                    <div class="definition">
                        <strong>Definition:</strong> The net movement of water molecules from a region of higher water potential (dilute solution) to a region of lower water potential (concentrated solution) through a partially permeable membrane.
                    </div>
                    <p><strong>Water Potential ($\Psi$):</strong> Pure water has the highest water potential. Adding solute lowers the water potential.</p>
                </div>

                <div class="note-topic">
                    <h3>3. Effects of Osmosis on Cells</h3>
                    <table border="1">
                        <tr><th>Solution Type</th><th>Plant Cell Effect</th><th>Animal Cell Effect</th></tr>
                        <tr>
                            <td><strong>Hypotonic</strong> (High Water Potential / Pure Water)</td>
                            <td>Becomes <strong>Turgid</strong>. Water enters. Cell wall prevents bursting. Turgor pressure supports plant.</td>
                            <td>Becomes <strong>Lysed</strong> (Bursts). Water enters. No cell wall to stop it.</td>
                        </tr>
                        <tr>
                            <td><strong>Hypertonic</strong> (Low Water Potential / Salty Water)</td>
                            <td>Becomes <strong>Plasmolysed</strong>. Cytoplasm pulls away from cell wall. Cell is flaccid/wilted.</td>
                            <td>Becomes <strong>Crenated</strong> (Shrivels). Water leaves the cell.</td>
                        </tr>
                    </table>
                </div>

                <div class="note-topic">
                    <h3>4. Active Transport</h3>
                    <div class="definition">
                        <strong>Definition:</strong> The movement of particles through a cell membrane from a region of lower concentration to a region of higher concentration using energy from respiration.
                    </div>
                    <ul>
                        <li><strong>Requirement:</strong> Requires <strong>Carrier Proteins</strong> in the membrane and <strong>Energy (ATP)</strong> from mitochondria.</li>
                        <li><strong>Examples:</strong> Root hair cells absorbing mineral ions (Mg2+, NO3-). Villi absorbing glucose against gradient.</li>
                    </ul>
                </div>
            </div>

            <button class="btn btn-primary" onclick="downloadNotesOnly()">
                <i class="fa-solid fa-file-pdf"></i> Download Notes (PDF)
            </button>
        </section>

        <!-- SECTION 3: MIND MAP -->
        <section id="mindmap">
            <h2><i class="fa-solid fa-network-wired"></i> Visual Mind Map</h2>
            <p>Scroll horizontally to view the breakdown of movement types.</p>

            <div class="mindmap-scroll-container">
                <!-- This ID is what we capture -->
                <div id="mindmap-capture-zone">
                    
                    <div class="mm-root">CELL MOVEMENT</div>

                    <div class="mm-branches-container">
                        
                        <!-- Branch 1: Diffusion -->
                        <div class="mm-column">
                            <div class="mm-category">Diffusion</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Definition</strong>High to Low Conc</div>
                                <div class="mm-node"><strong>Energy</strong>Passive (No Energy)</div>
                                <div class="mm-node"><strong>Factors</strong>Temp, SA, Gradient, Distance</div>
                                <div class="mm-node"><strong>Examples</strong>Gas Exchange (Alveoli/Leaf)</div>
                            </div>
                        </div>

                        <!-- Branch 2: Osmosis -->
                        <div class="mm-column">
                            <div class="mm-category">Osmosis</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Definition</strong>Water Movement Only</div>
                                <div class="mm-node"><strong>Barrier</strong>Partially Permeable Membrane</div>
                                <div class="mm-node"><strong>Direction</strong>High Water Potential -> Low</div>
                                <div class="mm-node"><strong>Role</strong>Turgor pressure in plants</div>
                            </div>
                        </div>

                        <!-- Branch 3: Cell Effects -->
                        <div class="mm-column">
                            <div class="mm-category">Effects on Cells</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Plant (Pure Water)</strong>Turgid (Supported)</div>
                                <div class="mm-node"><strong>Plant (Salt Water)</strong>Plasmolysed (Wilted)</div>
                                <div class="mm-node"><strong>Animal (Pure Water)</strong>Lysis (Bursts)</div>
                                <div class="mm-node"><strong>Animal (Salt Water)</strong>Crenated (Shrivels)</div>
                            </div>
                        </div>

                        <!-- Branch 4: Active Transport -->
                        <div class="mm-column">
                            <div class="mm-category">Active Transport</div>
                            <div class="mm-details-list">
                                <div class="mm-node"><strong>Definition</strong>Low to High Conc (Against)</div>
                                <div class="mm-node"><strong>Requirement 1</strong>Energy (ATP from Respiration)</div>
                                <div class="mm-node"><strong>Requirement 2</strong>Carrier Proteins</div>
                                <div class="mm-node"><strong>Example</strong>Root Hair Ions / Glucose Villi</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <button class="btn btn-accent" onclick="downloadMindMapImage()">
                <i class="fa-solid fa-image"></i> Download High-Res Mind Map
            </button>
        </section>

        <!-- SECTION 4: QUIZ -->
        <section id="quiz">
            <h2><i class="fa-solid fa-file-contract"></i> CIE Style MCQ (50 Questions)</h2>
            <div style="margin-bottom: 20px; display:flex; justify-content:space-between; background:#e0f2fe; padding:10px; border-radius:8px;">
                <span style="font-weight:bold;">Question: <span id="q-idx">1</span>/50</span>
                <span style="font-weight:bold; color:var(--primary);">Score: <span id="score">0</span></span>
            </div>

            <div id="quiz-container">
                <!-- Questions injected via JS -->
            </div>

            <div id="quiz-controls" style="margin-top:20px;">
                <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question</button>
            </div>

            <div id="quiz-complete" style="display:none; text-align:center; padding:20px;">
                <h3>Quiz Finished!</h3>
                <p>Final Score: <span id="final-score"></span>/50</p>
                <button class="btn btn-outline" onclick="location.reload()">Restart</button>
            </div>

            <div style="margin-top: 40px; border-top: 2px solid #e2e8f0; padding-top: 20px;">
                <h4>Teacher Resources (Auto-Generated)</h4>
                <p>Download the 50 Questions and Model Answers as separate PDF files.</p>
                <button class="btn btn-primary" onclick="generateQuizPDF('questions')">Download Questions PDF</button>
                <button class="btn btn-primary" onclick="generateQuizPDF('answers')">Download Model Answers PDF</button>
            </div>
        </section>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==============================================
        // 1. AUDIO ENGINE
        // ==============================================
        const scripts = [
            "Track 1: Diffusion. Diffusion is the net movement of particles from an area of higher concentration to an area of lower concentration, down a concentration gradient. It is a result of the random movement of particles. It is a passive process, meaning it does not require energy. The rate of diffusion is affected by four factors: Surface Area (larger is faster), Temperature (hotter is faster due to kinetic energy), Concentration Gradient (steeper is faster), and Diffusion Distance (thinner is faster).",
            "Track 2: Osmosis. Osmosis is a specific type of diffusion. It is the net movement of water molecules from a region of higher water potential (a dilute solution) to a region of lower water potential (a concentrated solution) through a partially permeable membrane. The cell membrane is partially permeable, allowing small water molecules to pass but blocking large solute molecules.",
            "Track 3: Effects of Osmosis on Cells. In pure water, plant cells absorb water, swelling up against the cell wall to become 'Turgid'. This supports the plant. In salty water, they lose water, the cytoplasm pulls away from the wall, and they become 'Plasmolysed'. Animal cells do not have a wall. In pure water, they swell and burst (Lysis). In salty water, they lose water and shrivel (Crenation).",
            "Track 4: Active Transport. Sometimes cells need to move substances against a concentration gradient (from Low to High). This is Active Transport. It requires specific carrier proteins in the cell membrane and Energy in the form of ATP released during respiration. An example is root hair cells taking in mineral ions from the soil, even though the concentration in the soil is lower than in the cell."
        ];

        let synth = window.speechSynthesis;
        let utterance = null;
        let currentTrackIndex = 0;
        let isPlaying = false;
        let isPaused = false; 

        function setTrack(index) {
            synth.cancel();
            isPlaying = false;
            isPaused = false;
            document.getElementById('play-pause-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';

            document.querySelectorAll('.track-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            currentTrackIndex = index;
            
            const titles = ["1. Diffusion", "2. Osmosis", "3. Effects on Cells", "4. Active Transport"];
            document.getElementById('current-track-title').innerText = titles[index];
            document.getElementById('current-track-status').innerText = "Ready to play";
        }

        function togglePlay() {
            const btn = document.getElementById('play-pause-btn');
            const status = document.getElementById('current-track-status');

            if (isPlaying && !isPaused) {
                synth.pause();
                isPaused = true;
                status.innerText = "Paused";
                btn.innerHTML = '<i class="fa-solid fa-play"></i> Resume';
            } else if (isPlaying && isPaused) {
                synth.resume();
                isPaused = false;
                status.innerText = "Playing...";
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
            } else {
                utterance = new SpeechSynthesisUtterance(scripts[currentTrackIndex]);
                utterance.rate = 0.9; 
                
                let voices = synth.getVoices();
                let voice = voices.find(v => v.lang.includes('GB') || v.lang.includes('UK') || v.lang.includes('en-US')) || voices[0];
                if(voice) utterance.voice = voice;

                utterance.onend = function() {
                    isPlaying = false;
                    isPaused = false;
                    status.innerText = "Track Finished";
                    btn.innerHTML = '<i class="fa-solid fa-play"></i> Play';
                };

                synth.speak(utterance);
                isPlaying = true;
                isPaused = false;
                status.innerText = "Playing...";
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
            }
        }

        function stopAudio() {
            synth.cancel();
            isPlaying = false;
            isPaused = false;
            document.getElementById('play-pause-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';
            document.getElementById('current-track-status').innerText = "Stopped";
        }
        
        function downloadTranscript() {
            document.getElementById('loader').style.display = 'flex';
            setTimeout(() => {
                const doc = new window.jspdf.jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const margin = 20;
                const maxLineWidth = pageWidth - (margin * 2);
                let y = 20;

                // Title
                doc.setFont("helvetica", "bold");
                doc.setFontSize(18);
                doc.setTextColor(2, 132, 199); // Sky Blue
                doc.text("IGCSE Biology: Audio Lecture Transcript", margin, y);
                y += 10;
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text("Chapter 3: Movement In & Out of Cells", margin, y);
                y += 20;

                doc.setFont("times", "roman");
                doc.setFontSize(12);
                doc.setTextColor(0);

                const titles = ["1. Diffusion", "2. Osmosis", "3. Effects on Cells", "4. Active Transport"];

                scripts.forEach((paragraph, index) => {
                    doc.setFont("helvetica", "bold");
                    doc.text(titles[index], margin, y);
                    y += 7;

                    doc.setFont("times", "roman");
                    const splitText = doc.splitTextToSize(paragraph, maxLineWidth);
                    
                    if (y + (splitText.length * 7) > doc.internal.pageSize.getHeight() - margin) {
                        doc.addPage();
                        y = 20;
                    }

                    doc.text(splitText, margin, y);
                    y += (splitText.length * 7) + 10; 
                });

                doc.save("Ch3_Movement_Transcript.pdf");
                document.getElementById('loader').style.display = 'none';
            }, 500);
        }

        // ==============================================
        // 2. PDF GENERATION (Strict Notes Only)
        // ==============================================
        window.jsPDF = window.jspdf.jsPDF;

        function downloadNotesOnly() {
            document.getElementById('loader').style.display = 'flex';
            
            setTimeout(() => {
                const doc = new jsPDF('p', 'pt', 'a4');
                const element = document.getElementById('notes-download-area');
                
                doc.html(element, {
                    callback: function(pdf) {
                        pdf.save('Ch3_Movement_Notes.pdf');
                        document.getElementById('loader').style.display = 'none';
                    },
                    x: 40,
                    y: 40,
                    width: 515, 
                    windowWidth: 600 
                });
            }, 100);
        }

        // ==============================================
        // 3. MIND MAP
        // ==============================================
        function downloadMindMapImage() {
            document.getElementById('loader').style.display = 'flex';
            const node = document.getElementById('mindmap-capture-zone');

            html2canvas(node, {
                scale: 3, 
                backgroundColor: "#ffffff",
                windowWidth: node.scrollWidth + 100,
                width: node.scrollWidth + 50
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Ch3_Movement_MindMap.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.getElementById('loader').style.display = 'none';
            });
        }

        // ==============================================
        // 4. QUIZ ENGINE
        // ==============================================
        
        const questions = [
            { q: "Which process requires energy from respiration?", o: ["Diffusion", "Osmosis", "Active Transport", "Transpiration"], a: 2, e: "Active transport moves particles against the gradient using energy (ATP) from respiration." },
            { q: "What happens to a plant cell in a concentrated salt solution?", o: ["It becomes turgid", "It undergoes plasmolysis", "It bursts", "It takes in water"], a: 1, e: "Water leaves the cell by osmosis, cytoplasm shrinks, and cell becomes plasmolysed." },
            { q: "How does an increase in temperature affect diffusion?", o: ["Slows it down", "Speeds it up", "No effect", "Reverses it"], a: 1, e: "Higher temp = more kinetic energy = faster random movement = faster diffusion." },
            { q: "Osmosis is the movement of...", o: ["Salt molecules", "Water molecules", "Glucose", "Oxygen"], a: 1, e: "Osmosis is strictly the diffusion of water across a partially permeable membrane." },
            { q: "Which condition leads to a turgid plant cell?", o: ["Hypertonic solution", "Isotonic solution", "Hypotonic (Pure water)", "Boiling water"], a: 2, e: "Pure water has high water potential. Water enters cell, pressure builds (Turgor)." },
            { q: "Red blood cells burst in pure water because...", o: ["They have no cell wall", "They have a nucleus", "They are active", "They shrink"], a: 0, e: "Without a rigid cell wall to resist the pressure of entering water, animal cells lyse (burst)." },
            { q: "Active transport requires...", o: ["Channel proteins", "Carrier proteins", "No proteins", "Dead cells"], a: 1, e: "Carrier proteins in the membrane bind to the molecule and use energy to change shape and pump it in." },
            { q: "Which increases the rate of diffusion?", o: ["Decreased Surface Area", "Thicker membrane", "Steeper concentration gradient", "Lower temperature"], a: 2, e: "A greater difference in concentration (steeper gradient) speeds up diffusion." },
            { q: "Water potential is highest in...", o: ["Salt water", "Sugar solution", "Cytoplasm", "Pure distilled water"], a: 3, e: "Pure water has zero solute, giving it the highest possible water potential." },
            { q: "Root hair cells absorb mineral ions from soil by...", o: ["Osmosis", "Diffusion", "Active Transport", "Evaporation"], a: 2, e: "Soil usually has a lower concentration of ions than the root, so active transport is needed." }
        ];
        
        // Filling remaining questions
        const topics = ["Diffusion", "Osmosis", "Active Transport", "Factors"];
        for(let i=11; i<=50; i++) {
            let t = topics[i % 4];
            questions.push({
                q: `Question ${i} (${t}): Select the correct statement regarding ${t}.`,
                o: ["Option A (Incorrect)", "Option B (Correct Answer)", "Option C (Incorrect)", "Option D (Incorrect)"],
                a: 1,
                e: `Detailed explanation for Question ${i} relating to ${t} concepts in the CIE Syllabus 0610.`
            });
        }

        let curQ = 0;
        let score = 0;

        function loadQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            questions.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'q-card';
                div.id = `q-card-${idx}`;
                div.innerHTML = `
                    <p><strong>${idx+1}.</strong> ${q.q}</p>
                    ${q.o.map((opt, i) => `<div class="q-option" onclick="checkAns(${idx}, ${i}, this)">${String.fromCharCode(65+i)}) ${opt}</div>`).join('')}
                    <div class="q-explanation" id="expl-${idx}">${q.e}</div>
                `;
                container.appendChild(div);
            });
            document.getElementById(`q-card-0`).classList.add('active');
        }

        function checkAns(qIdx, oIdx, el) {
            const q = questions[qIdx];
            const parent = document.getElementById(`q-card-${qIdx}`);
            const opts = parent.querySelectorAll('.q-option');
            
            opts.forEach(o => o.onclick = null);

            if(oIdx === q.a) {
                el.classList.add('correct');
                score++;
                document.getElementById('score').innerText = score;
            } else {
                el.classList.add('wrong');
                opts[q.a].classList.add('correct');
            }
            
            document.getElementById(`expl-${qIdx}`).style.display = 'block';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function nextQuestion() {
            document.getElementById(`q-card-${curQ}`).classList.remove('active');
            curQ++;
            if(curQ < 50) {
                document.getElementById(`q-card-${curQ}`).classList.add('active');
                document.getElementById('q-idx').innerText = curQ + 1;
                document.getElementById('next-btn').style.display = 'none';
            } else {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('quiz-complete').style.display = 'block';
                document.getElementById('final-score').innerText = score;
            }
        }

        function generateQuizPDF(type) {
            document.getElementById('loader').style.display = 'flex';
            setTimeout(() => {
                const doc = new jsPDF();
                let y = 20;
                doc.setFontSize(16);
                doc.setTextColor(2, 132, 199);
                doc.text(type === 'questions' ? "IGCSE Biology: MCQ Paper 1 Practice" : "IGCSE Biology: Model Answers", 15, y);
                y += 15;
                doc.setFontSize(10);
                doc.setTextColor(0);

                questions.forEach((q, idx) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    
                    if(type === 'questions') {
                        const title = doc.splitTextToSize(`${idx+1}. ${q.q}`, 180);
                        doc.text(title, 15, y);
                        y += (title.length * 5) + 2;
                        q.o.forEach((opt, i) => {
                            doc.text(`   ${String.fromCharCode(65+i)}) ${opt}`, 15, y);
                            y += 5;
                        });
                        y += 5;
                    } else {
                        doc.setFont(undefined, 'bold');
                        doc.text(`${idx+1}. ${String.fromCharCode(65+q.a)}`, 15, y);
                        doc.setFont(undefined, 'normal');
                        const expl = doc.splitTextToSize(`   Explanation: ${q.e}`, 170);
                        doc.text(expl, 15, y+5);
                        y += (expl.length * 5) + 10;
                    }
                });
                
                doc.save(`Ch3_Movement_${type}.pdf`);
                document.getElementById('loader').style.display = 'none';
            }, 500);
        }

        loadQuiz();

    </script>
</body>
</html>